# OpenBookVault
一个开源的在线书店系统，提供免费电子借阅和书籍位置查询功能，集成了版权保护、书籍分类和数据可视化。本项目是2024年11月18日至2024年12月20日的毕业设计作品。
# 后台管理员系统逻辑与安全

## 1. 管理员逻辑

### 管理员登录
- 管理员通过 `login.php` 页面提交用户名和密码。
- 后端 PHP 代码（`login.php`）会从数据库查询用户，验证密码是否正确。
- 如果密码正确，后台会根据角色 `role_id` 来决定用户的权限：
  - **管理员**（`role_id = 1`）会跳转到管理员首页。
  - **普通用户**（`role_id = 2`）会跳转到普通用户的首页。

### 权限控制
- **管理员**（`role_id = 1`）拥有访问后台管理系统的权限，可以管理系统内的书籍、用户和借阅记录等。
- **普通用户**（`role_id = 2`）仅有查看和借阅图书的权限，不会访问后台管理功能。

## 2. 安全措施

### 密码加密与验证
- **密码加密存储**：
  - 在注册用户时，密码使用 `password_hash()` 函数进行加密，存储到数据库中。
  - 在用户登录时，使用 `password_verify()` 验证用户输入的密码和数据库存储的加密密码是否匹配。
  - 加密后的密码存储，增加了数据泄露的难度，保证了用户信息的安全。

### Session 和 Cookie 安全
- 使用 **`$_SESSION`** 来保存用户的登录状态，管理员的 `user_id` 和 `role_id` 被存储在 session 中。
- **Session 安全性**：
  - **会话劫持防护**：每次登录后，管理员的 `session_id` 会与用户 IP 地址和 User-Agent 一起进行存储，从而避免被攻击者劫持。
  - **Session 超时**：可以设置一个有效期，超过一定时间未操作的会话将自动过期，需要重新登录。
  - **Session 销毁**：在管理员登出时，应销毁会话（`session_destroy()`），清除所有敏感信息。

### 防止 SQL 注入
- 在用户输入数据时，使用 **预处理语句**（`prepared statements`）来避免 SQL 注入攻击：
  ```php
  $stmt = $conn->prepare("SELECT * FROM users WHERE username = ?");
  $stmt->bind_param("s", $username); // 绑定参数，防止 SQL 注入
  $stmt->execute();

## 权限验证

在后台管理系统中，确保每个页面都做权限验证，只有 **管理员角色** 才能访问后台管理界面。权限验证是为了确保未经授权的用户不能访问敏感的管理功能，防止出现非法操作。

### 1. 权限验证流程

1. **登录验证**：首先，检查用户是否已经登录，登录成功后会将用户的 `user_id` 和 `role_id` 存储在 session 中。
2. **角色验证**：检查用户的 `role_id` 是否为管理员角色。通常，管理员角色的 `role_id` 为 1，普通用户的 `role_id` 为 2。
3. **拒绝非管理员访问**：如果 `role_id` 不是管理员的标识，系统会自动重定向到登录页或普通用户页面，防止非管理员用户访问后台管理功能。

### 2. 后台权限验证代码示例

在后台管理系统的每个需要权限控制的页面中，可以使用以下代码片段进行权限验证。

```php
<?php
session_start();

// 检查用户是否已登录
if (!isset($_SESSION['user_id'])) {
    // 用户未登录，跳转到登录页面
    header('Location: login.php');
    exit();
}

// 检查用户是否为管理员角色
if ($_SESSION['role_id'] !== 1) {
    // 如果不是管理员，重定向到普通用户页面
    header('Location: user_dashboard.php');
    exit();
}

// 继续执行管理员页面的其他操作
?>
